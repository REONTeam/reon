{% extends "main.twig" %}

{% block title %}Game Boy Wars 3 - Map Gallery{% endblock %}

{% block head %}
<style>
    .map-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .map-card {
        background: var(--bs-body-bg);
        border: 1px solid var(--bs-border-color);
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
    }

    .map-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    }

    .map-preview {
        width: 100%;
        aspect-ratio: 1;
        background: #111;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .map-preview img {
        max-width: 100%;
        max-height: 100%;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
    }

    .map-info {
        padding: 15px;
    }

    .map-info h5 {
        margin-bottom: 8px;
    }

    .map-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        color: var(--bs-secondary);
    }

    .map-meta .map-id {
        font-family: monospace;
        background: var(--bs-tertiary-bg);
        padding: 2px 8px;
        border-radius: 4px;
    }

    .map-meta .map-price {
        color: var(--bs-success);
        font-weight: bold;
    }

    /* Modal styles */
    .modal-body .map-preview-large {
        text-align: center;
    }

    .modal-body .map-preview-large img {
        max-width: 100%;
        max-height: 70vh;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
    }
</style>
{% endblock %}

{% block content %}
    <h1>Game Boy Wars 3</h1>
    <p class="lead">Map Gallery - {{ maps|length }} maps available</p>

    {% if maps is empty %}
        <div class="alert alert-info">
            <h4>No Maps Available</h4>
            <p>Run the seeder to import maps:</p>
            <code>vendor/bin/phinx seed:run -s GameboyWars3Seeder</code>
        </div>
    {% else %}
        <div class="map-grid">
            {% for map in maps %}
                <div class="map-card"
                     data-bs-toggle="modal"
                     data-bs-target="#previewModal"
                     data-map-id="{{ map.map_id }}"
                     data-map-name="{{ map.map_name }}"
                     data-map-size="{{ map.width }}x{{ map.height }}"
                     data-map-price="{{ map.price_yen }}">
                    <div class="map-preview">
                        <img src="preview.php?id={{ map.map_id|url_encode }}&size=8"
                             alt="Map {{ map.map_id }}"
                             loading="lazy">
                    </div>
                    <div class="map-info">
                        <h5>{{ map.map_name }}</h5>
                        <div class="map-meta">
                            <span class="map-id">#{{ map.map_id }}</span>
                            <span class="map-size">{{ map.width }}x{{ map.height }}</span>
                            <span class="map-price">{{ map.price_yen }}¥</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalLabel">Map Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="map-preview-large">
                        <img id="modalImage" src="" alt="Map Preview">
                    </div>
                    <div class="mt-3 text-center">
                        <span id="modalSize" class="badge bg-secondary me-2"></span>
                        <span id="modalPrice" class="badge bg-success"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const previewModal = document.getElementById('previewModal');
        previewModal.addEventListener('show.bs.modal', function (event) {
            const card = event.relatedTarget;
            const mapId = card.dataset.mapId;
            const mapName = card.dataset.mapName;
            const mapSize = card.dataset.mapSize;
            const mapPrice = card.dataset.mapPrice;

            document.getElementById('previewModalLabel').textContent = mapName;
            document.getElementById('modalImage').src = 'preview.php?id=' + encodeURIComponent(mapId) + '&size=16';
            document.getElementById('modalSize').textContent = mapSize;
            document.getElementById('modalPrice').textContent = mapPrice + '¥';
        });
    </script>
{% endblock %}
